<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="assets/waifu.css?v=1.4.2"/>
</head>
<body style="font-family: 'Microsoft YaHei';">
    <!-- waifu-tips.js 依赖 JQuery 库 -->
    <script src="assets/jquery.min.js?v=3.3.1"></script>
    
    <!-- 实现拖动效果，需引入 JQuery UI -->
    <script src="assets/jquery-ui.min.js?v=1.12.1"></script>
    
    <div class="waifu">
        <div class="waifu-tips"></div>
        <canvas id="live2d" class="live2d"></canvas>
        <div class="waifu-tool">
            <span class="fui-pause"></span>
            <span class="fui-home"></span>
            <span class="fui-chat"></span>
            <span class="fui-eye"></span>
            <span class="fui-user"></span>
            <span class="fui-photo"></span>
            <span class="fui-info-circle"></span>
            <span class="fui-star"></span>
            <span class="fui-video"></span>
            <span class="fui-mail"></span>
            <span class="fui-gear"></span>
            <span class="fui-cross"></span>
        </div>
        <div class="waifu-chat-box" style="display:none;">
            <div id="waifu-img-preview-container" style="display:none;">
                <img id="waifu-preview-img" src="" alt="preview">
                <span id="waifu-preview-close">×</span>
            </div>

            <input type="file" id="waifu-file-input" accept="image/*" style="display:none;">
            <button id="waifu-upload-btn">
                <span class="fui-plus"></span>
            </button>

            <input id="waifu-input" type="text" placeholder="和看板娘聊聊天吧！" autocomplete="off">

            <button id="waifu-send-btn">
                <span class="fui-triangle-right-large"></span>
            </button>
        </div>
        <div class="waifu-history-panel">
            <div class="history-header">
                <span>与看板娘的回忆</span>
                <span class="history-close">×</span>
            </div>
            <div class="history-content" id="history-list">
                <!-- JS 会把聊天记录填充到这里 -->
                <div class="history-empty">暂无对话记录</div>
            </div>
        </div>
        <div class="waifu-settings-panel">
        <div class="settings-header">
            <span>看板娘全局设置</span>
            <span class="settings-close">×</span>
        </div>
        <div id="settings-inject-point"></div> 
    </div>
    
    <script src="assets/waifu-config.js"></script>
    <script src="assets/waifu-tips.js?v=1.4.2"></script>
    <script src="assets/live2d.js?v=1.0.5"></script>
    <script type="text/javascript">
        // 定义加载函数
        function loadSettingsAndInit() {
            // 使用 fetch 或 jQuery load 加载公共 HTML
            $("#settings-inject-point").load("settings-content.html", function() {
                // 加载完成后，再初始化模型，确保 DOM 存在
                initModel("assets/waifu-tips.json?v=1.4.2");
                
                // 绑定 Tab 切换逻辑（如果 waifu-tips.js 里没写通过委托绑定的话，这里需要补充）
                $('.settings-tab-item').click(function() {
                    $(this).addClass('active').siblings().removeClass('active');
                    var tab = $(this).data('tab');
                    $(this).closest('.settings-content, .waifu-settings-panel').find('.tab-pane').hide();
                    $('#tab-' + tab).show();
                });
            });
        }

        // 执行加载
        loadSettingsAndInit();
    </script>
</body>
</html>