<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="assets/waifu.css?v=1.4.2"/>
</head>
<body style="font-family: 'Microsoft YaHei';">
    <!-- waifu-tips.js 依赖 JQuery 库 -->
    <script src="assets/jquery.min.js?v=3.3.1"></script>
    
    <!-- 实现拖动效果，需引入 JQuery UI -->
    <script src="assets/jquery-ui.min.js?v=1.12.1"></script>
    
    <div class="waifu">
        <div class="waifu-tips"></div>
        <canvas id="live2d" class="live2d"></canvas>
        <div class="waifu-tool">
            <span class="fui-home"></span>
            <span class="fui-chat"></span>
            <span class="fui-eye"></span>
            <span class="fui-user"></span>
            <span class="fui-photo"></span>
            <span class="fui-info-circle"></span>
            <span class="fui-cross"></span>
            <span class="fui-star"></span>
            <span class="fui-video"></span>
            <span class="fui-gear"></span>
        </div>
        <div class="waifu-chat-box" style="display:none;">
            <input id="waifu-input" type="text" placeholder="聊点什么？(回车发送)" autocomplete="off">
            <button id="waifu-send-btn">发送</button>
        </div>
        <div class="waifu-settings-panel">
        <div class="settings-header">
            <span>看板娘全局设置</span>
            <span class="settings-close">×</span>
        </div>
        
        <!-- 顶部 Tab 导航 -->
        <div class="settings-tabs">
            <div class="settings-tab-item active" data-tab="general">常规</div>
            <div class="settings-tab-item" data-tab="style">样式</div>
            <div class="settings-tab-item" data-tab="toolbar">工具栏</div>
            <div class="settings-tab-item" data-tab="llm">LLM设置</div>
        </div>

        <div class="settings-content">
            
            <!-- Tab 1: 常规设置 (接口、提示消息、杂项) -->
            <div id="tab-general" class="tab-pane active">
                <div class="setting-section-title">后端与API</div>
                <div class="setting-group">
                    <label class="setting-label">一言 API 源</label>
                    <select data-key="hitokotoAPI" class="waifu-select config-item">
                        <option value="hitokoto.cn">hitokoto.cn (默认)</option>
                        <option value="lwl12.com">lwl12.com</option>
                        <option value="jinrishici.com">jinrishici.com (古诗词)</option>
                        <option value="fghrsh.net">fghrsh.net</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Tips JSON 路径</label>
                    <input data-key="tipsMessage" class="waifu-select config-item" type="text">
                </div>

                <div class="setting-section-title">交互与提示消息</div>
                <div class="setting-group checkbox-group">
                    <label><input data-key="showHitokoto" class="config-item" type="checkbox"> 显示一言 (空闲时)</label>
                    <label><input data-key="showWelcomeMessage" class="config-item" type="checkbox"> 显示欢迎词</label>
                    <label><input data-key="showCopyMessage" class="config-item" type="checkbox"> 显示复制提示</label>
                    <label><input data-key="showF12Status" class="config-item" type="checkbox"> F12 显示加载状态</label>
                    <label><input data-key="showF12Message" class="config-item" type="checkbox"> F12 显示看板娘消息</label>
                    <label><input data-key="showF12OpenMsg" class="config-item" type="checkbox"> F12 显示打开提示</label>
                </div>

                <div class="setting-section-title">模型切换偏好</div>
                <div class="setting-group checkbox-group">
                    <label><input data-key="modelStorage" class="config-item" type="checkbox"> 记录模型ID (刷新恢复)</label>
                </div>
                <div class="setting-group">
                    <label class="setting-label">模型切换模式</label>
                    <select data-key="modelRandMode" class="waifu-select config-item">
                        <option value="switch">顺序切换</option>
                        <option value="rand">随机切换</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">材质切换模式</label>
                    <select data-key="modelTexturesRandMode" class="waifu-select config-item">
                        <option value="rand">随机切换</option>
                        <option value="switch">顺序切换</option>
                    </select>
                </div>
            </div>

            <!-- Tab 2: 样式设置 -->
            <div id="tab-style" class="tab-pane" style="display:none;">
                <div class="setting-section-title">尺寸与位置 (需刷新生效)</div>
                <div class="setting-group">
                    <label class="setting-label">看板娘大小 (宽x高)</label>
                    <input data-key="waifuSize" class="waifu-select config-item" type="text" placeholder="280x250">
                </div>
                <div class="setting-group">
                    <label class="setting-label">提示框大小 (宽x高)</label>
                    <input data-key="waifuTipsSize" class="waifu-select config-item" type="text" placeholder="250x75">
                </div>
                <div class="setting-group">
                    <label class="setting-label">字体大小</label>
                    <input data-key="waifuFontSize" class="waifu-select config-item" type="text" placeholder="12px">
                </div>
                <div class="setting-group">
                    <label class="setting-label">贴边设置 (left:0 / right:30)</label>
                    <input data-key="waifuEdgeSide" class="waifu-select config-item" type="text">
                </div>

                <div class="setting-section-title">工具栏样式</div>
                <div class="setting-group">
                    <label class="setting-label">工具栏字体大小</label>
                    <input data-key="waifuToolFont" class="waifu-select config-item" type="text" placeholder="14px">
                </div>
                <div class="setting-group">
                    <label class="setting-label">工具栏行高</label>
                    <input data-key="waifuToolLine" class="waifu-select config-item" type="text" placeholder="20px">
                </div>
                <div class="setting-group">
                    <label class="setting-label">工具栏顶部偏移</label>
                    <input data-key="waifuToolTop" class="waifu-select config-item" type="text" placeholder="-20px">
                </div>
                
                <div class="setting-section-title">交互行为</div>
                <div class="setting-group">
                    <label class="setting-label">拖拽设置</label>
                    <select data-key="waifuDraggable" class="waifu-select config-item">
                        <option value="disable">禁用拖拽</option>
                        <option value="axis-x">水平拖拽</option>
                        <option value="unlimited">自由拖拽</option>
                    </select>
                </div>
                <div class="setting-group checkbox-group">
                    <label><input data-key="waifuDraggableRevert" class="config-item" type="checkbox"> 松开鼠标还原位置</label>
                </div>
            </div>

            <!-- Tab 3: 工具栏设置 -->
            <div id="tab-toolbar" class="tab-pane" style="display:none;">
                <div class="setting-section-title">按钮显示开关</div>
                <div class="setting-group checkbox-group">
                    <label><input data-key="showToolMenu" class="config-item" type="checkbox"> <b>显示整个工具栏</b></label>
                    <hr>
                    <label><input data-key="canTurnToHomePage" class="config-item" type="checkbox"> 返回首页 (房子)</label>
                    <label><input data-key="canSwitchHitokoto" class="config-item" type="checkbox"> 一言切换 (气泡)</label>
                    <label><input data-key="canSwitchModel" class="config-item" type="checkbox"> 模型切换 (眼睛)</label>
                    <label><input data-key="canSwitchTextures" class="config-item" type="checkbox"> 材质切换 (衣服)</label>
                    <label><input data-key="canTakeScreenshot" class="config-item" type="checkbox"> 看板娘截图 (相机)</label>
                    <label><input data-key="canTurnToAboutPage" class="config-item" type="checkbox"> 关于页 (信息)</label>
                    <label><input data-key="canCloseLive2d" class="config-item" type="checkbox"> 关闭看板娘 (叉号)</label>
                    <hr>
                    <div style="color:#3498db; margin:5px 0; font-weight:bold;">扩展功能按钮</div>
                    <label><input data-key="showLLM" class="config-item" type="checkbox"> LLM 对话 (星星)</label>
                    <label><input data-key="showPeek" class="config-item" type="checkbox"> Peek 屏幕观察 (录像机)</label>
                    <label><input data-key="showSettings" class="config-item" type="checkbox"> 设置面板 (齿轮)</label>
                </div>
            </div>

            <!-- Tab 4: LLM 设置 -->
            <div id="tab-llm" class="tab-pane" style="display:none;">
                <div class="setting-section-title">核心接口配置</div>
                <div class="setting-group">
                    <label class="setting-label">LLM API 地址</label>
                    <input data-key="llmApiUrl" class="waifu-select config-item" type="text" placeholder="http://127.0.0.1:11434/v1/chat/completions">
                </div>
                <div class="setting-group">
                    <label class="setting-label">API Key (Ollama可留空)</label>
                    <input data-key="llmApiKey" class="waifu-select config-item" type="password">
                </div>
                <div class="setting-group">
                    <label class="setting-label">Python 后端地址 (Peek)</label>
                    <input data-key="pythonServerUrl" class="waifu-select config-item" type="text" placeholder="http://127.0.0.1:11542/">
                </div>

                <div class="setting-section-title" style="margin-top:15px;">模型选择</div>
                <div class="setting-group">
                    <label class="setting-label">
                        普通模型 (响应快)
                        <button id="btn-refresh-models" class="waifu-btn secondary" style="padding:1px 5px;font-size:10px;float:right;">刷新列表</button>
                    </label>
                    <select id="model-normal" class="waifu-select">
                        <option value="">点击刷新...</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">思考模型 (能力强)</label>
                    <select id="model-thinking" class="waifu-select">
                        <option value="">点击刷新...</option>
                    </select>
                </div>

                <div class="setting-section-title" style="margin-top:15px;">功能开关</div>
                <div class="setting-group checkbox-group">
                    <label><input id="use-thinking-waifu" type="checkbox"> 看板娘对话使用思考模型</label>
                    <label><input id="use-thinking-chat" type="checkbox"> 聊天助手使用思考模型</label>
                    <label><input id="use-thinking-roast" type="checkbox"> 屏幕吐槽使用思考模型</label>
                </div>
                
                <div class="setting-section-title" style="margin-top:15px;">自动与定时</div>
                <div class="setting-group checkbox-group">
                    <label><input data-key="autoRoast" class="config-item" type="checkbox"> 开启自动定时吐槽</label>
                </div>
                <div class="setting-group">
                    <label class="setting-label">自动间隔 (毫秒, 60000=1分钟)</label>
                    <input data-key="roastInterval" class="waifu-select config-item" type="number">
                </div>

                <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">

                <div class="setting-section-title">Peek 详细参数</div>
                <div class="setting-group">
                    <label class="setting-label">功能模式</label>
                    <select id="peek-mode" class="waifu-select">
                        <option value="roast">屏幕吐槽 (Roast)</option>
                        <option value="chat">聊天助手 (Chat Helper)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">截图范围</label>
                    <select id="peek-target-type" class="waifu-select">
                        <option value="fullscreen">全屏截图</option>
                        <option value="window">指定窗口</option>
                    </select>
                </div>
                <div class="setting-group" id="group-window-select" style="display:none;">
                    <label class="setting-label">
                        选择窗口 
                        <button id="btn-refresh-windows" class="waifu-btn secondary" style="padding:2px 5px; font-size:10px;">刷新</button>
                    </label>
                    <select id="peek-window-list" class="waifu-select">
                        <option value="0">请点击刷新...</option>
                    </select>
                </div>

                <div class="setting-group prompt-group" id="group-prompt-roast" style="margin-top:10px;">
                    <label class="setting-label">
                        吐槽提示词 
                        <button id="btn-reset-roast" class="waifu-btn secondary" style="float:right;padding:1px 5px;font-size:10px;">重置</button>
                    </label>
                    <textarea id="prompt-roast" class="waifu-textarea"></textarea>
                </div>
                <div class="setting-group prompt-group" id="group-prompt-chat" style="display:none;margin-top:10px;">
                    <label class="setting-label">
                        助手提示词
                        <button id="btn-reset-chat" class="waifu-btn secondary" style="float:right;padding:1px 5px;font-size:10px;">重置</button>
                    </label>
                    <textarea id="prompt-chat" class="waifu-textarea"></textarea>
                </div>
            </div>

            <!-- 底部保存提示 -->
            <div style="text-align:center; padding:10px; color:#888; font-size:12px; border-top:1px solid #eee; background:#fafafa;">
                部分设置刷新网页后生效
            </div>
        </div>
    </div>
        
    <script src="assets/waifu-tips.js?v=1.4.2"></script>
    <script src="assets/live2d.js?v=1.0.5"></script>
    <script type="text/javascript">
        /* 在 initModel 前添加 */
        initModel("assets/waifu-tips.json?v=1.4.2")
    </script>
</body>
</html>
